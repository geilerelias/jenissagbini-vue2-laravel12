import{A as a}from"./AppLayout-BImsDSli.js";import{B as n}from"./BreadCrumbs-BH02ZRtw.js";import{n as l}from"./_plugin-vue2_normalizer-p4i_2SC9.js";import"./SettingsDropdown-D9hkqat8.js";import"./app-BzUSuKBB.js";import"./logo-Cxn_AZdb.js";const d={components:{AppLayout:a,BreadCrumbs:n},props:["data","errors"],data(){return{loadingNewItem:!1,loadingEditItem:!1,loadingDeleteItem:!1,selectedRole:[],selectedPermission:[],permission:[],editMode:!1,isOpen:!1,search:"",searchPermission:"",form:{id:null,name:null},items:[{text:"Dashboard",disabled:!1,href:"/dashboard"},{text:"Roles",disabled:!0,href:"/roles"}],dialog:!1,dialogDelete:!1,headers:[{text:"Id",align:"start",sortable:!1,value:"id"},{text:"Name",value:"name"},{text:"Actions",value:"actions",sortable:!1}],loading:!1,headersPermission:[{text:"Id",align:"start",sortable:!1,value:"id"},{text:"Name",value:"name"}],desserts:[],editedIndex:-1,editedItem:{name:""},defaultItem:{name:""}}},created(){for(let s=0;s<this.data.length;s++)axios.get(`/role/${this.data[s].id}/permissions`).then(e=>{this.data[s].permission=e.data}).catch(e=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")});axios.get("permission/all").then(s=>{this.permission=s.data}).catch(s=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")})},computed:{formTitle(){return this.editedIndex===-1?"New Item":"Edit Item"}},watch:{selectedRole(s){if(s.length>0){this.selectedPermission=[];let e=s[0].permission;for(const t in e){let i=this.permission.find(r=>r.name===e[t].name);this.selectedPermission.push(i)}}},dialog(s){s||this.close()}},methods:{grantPermissions(){if(this.selectedRole.length>0)if(this.selectedPermission.length>0){let s=[];for(let t=0;t<this.selectedPermission.length;t++)s.push(this.selectedPermission[t].name);let e={role:this.selectedRole[0].id,permission:s};this.$inertia.post("/role/assign/permissions",e,{onStart:t=>{console.log("onStart",t),this.loading=!0},onSuccess:t=>{this.$swal({icon:`${t.props.errors.name?"error":"success"}`,title:`${t.props.errors.name?"Oops...":"Good job!"}`,text:`${t.props.errors.name?t.props.errors.name[0]:t.props.flash.message}`})},onError:t=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")},onFinish:t=>{this.loading=!1}})}else this.$swal("Opps...!","you must select a permission.","warning");else this.$swal("Opps...!","you must select a role.","warning")},closeModal:function(){this.isOpen=!1,this.reset(),this.editMode=!1},reset(){this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},update(s){s._method="PUT",this.$inertia.post("/role/"+s.id,s,{onStart:e=>{this.loadingEditItem=!0},onSuccess:e=>{this.$swal({icon:`${e.props.errors.name?"error":"success"}`,title:`${e.props.errors.name?"Oops...":"Good job!"}`,text:`${e.props.errors.name?e.props.errors.name[0]:e.props.flash.message}`})},onError:e=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")},onFinish:e=>{this.loadingEditItem=!1}}),this.reset(),this.closeModal(),this.editMode=!1,this.close()},editItem(s){this.editedIndex=this.data.indexOf(s),console.log(this.editedIndex),this.editedItem=Object.assign({},s),this.dialog=!0},deleteItem(s){s._method="DELETE",this.$swal({title:"Are you sure you want to delete this item?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(e=>{e.isConfirmed&&(this.$inertia.post("/role/"+s.id,s,{onStart:t=>{this.loadingDeleteItem=!0},onSuccess:t=>{this.$swal("Deleted!","Your item has been deleted.","success")},onError:t=>{this.$swal("Opps...!","Excuse me, an error occurred.","warning")},onFinish:t=>{this.loadingDeleteItem=!1}}),this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))}),this.reset()},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(s){this.editedIndex===-1?(console.log("save"),this.$inertia.post("/role",s,{onStart:e=>{this.loadingNewItem=!0},onSuccess:e=>{this.$swal({icon:`${e.props.errors.name?"error":"success"}`,title:`${e.props.errors.name?"Oops...":"¡Buen trabajo!"}`,text:`${e.props.errors.name?e.props.errors.name[0]:e.props.flash.message}`})},onError:e=>{console.log(e),this.$swal({icon:"error",title:"Oops...",text:this.errors.errors.name[0]})},onFinish:e=>{this.loadingNewItem=!1,this.reset(),this.closeModal(),this.editMode=!1,this.close()}})):(console.log("update"),this.$inertia.put("/posts/"+s.id,s,{onSuccess:e=>{console.log(e),this.$swal({icon:`${e.props.errors.name?"error":"success"}`,title:`${e.props.errors.name?"Oops...":"¡Buen trabajo!"}`,text:`${e.props.errors.name?e.props.errors.name[0]:e.props.flash.message}`})},onError:e=>{console.log(e),this.$swal({icon:"error",title:"Oops...",text:this.errors.errors.name[0]})},onFinish:e=>{this.reset(),this.closeModal(),this.editMode=!1,this.close()}}))},initialize(){location.reload()}}};var c=function(){var e=this,t=e._self._c;return t("app-layout",[t("bread-crumbs",{attrs:{name:"Roles",items:e.items}}),t("v-container",{staticClass:"d-flex justify-center"},[t("div",[t("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.data,"sort-by":"calories",search:e.search,"single-select":"","single-expand":"","show-select":"","show-expand":""},scopedSlots:e._u([{key:"top",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-text-field",{staticClass:"mr-3",attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(i){e.search=i},expression:"search"}}),t("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t("v-spacer"),t("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[t("v-btn",e._g(e._b({staticClass:"mb-2",attrs:{color:"primary",dark:"",loading:e.loadingNewItem,disabled:e.loadingNewItem}},"v-btn",r,!1),i),[e._v(" New Item ")])]}}]),model:{value:e.dialog,callback:function(i){e.dialog=i},expression:"dialog"}},[t("v-card",[t("v-card-title",[t("span",{staticClass:"text-h5"},[e._v(e._s(e.formTitle))])]),t("v-card-text",[t("v-container",[t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-text-field",{attrs:{label:"Name"},model:{value:e.editedItem.name,callback:function(i){e.$set(e.editedItem,"name",i)},expression:"editedItem.name"}})],1)],1)],1)],1),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v(" Cancel ")]),e.editedIndex===-1?t("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(i){return e.save(e.editedItem)}}},[e._v(" Save ")]):t("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(i){return e.update(e.editedItem)}}},[e._v(" update ")])],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function({item:i}){return[t("v-icon",{staticClass:"mr-2",attrs:{small:"",loading:e.loadingEditItem,disabled:e.loadingEditItem},on:{click:function(r){return e.editItem(i)}}},[e._v(" mdi-pencil ")]),t("v-icon",{attrs:{small:"",loading:e.loadingDeleteItem,disabled:e.loadingDeleteItem},on:{click:function(r){return e.deleteItem(i)}}},[e._v(" mdi-delete ")])]}},{key:"expanded-item",fn:function({headers:i,item:r}){return[t("td",{attrs:{colspan:i.length}},[e._v(" established permissions: "),e._l(r.permission,function(o){return t("v-chip",{key:o.id,staticClass:"ma-2 white--text",attrs:{color:"indigo",small:""}},[e._v(" "+e._s(o.name)+" ")])})],2)]}},{key:"no-data",fn:function(){return[t("v-btn",{attrs:{color:"primary"},on:{click:e.initialize}},[e._v(" Reset ")])]},proxy:!0}]),model:{value:e.selectedRole,callback:function(i){e.selectedRole=i},expression:"selectedRole"}})],1)]),t("v-container",[t("v-card",[t("v-toolbar",{attrs:{flat:""}},[t("v-toolbar-title",[e._v("Permission")]),t("v-spacer"),e.selectedRole.length>0?t("span",[e._v("selected role "+e._s(e.selectedRole[0].name))]):t("span",[e._v(" role not selected")])],1),t("v-banner",{attrs:{"single-line":""},scopedSlots:e._u([{key:"actions",fn:function(){return[t("v-btn",{attrs:{text:"",color:"deep-purple accent-4",loading:e.loading,disabled:e.loading},on:{click:e.grantPermissions}},[e._v(" grant permissions ")])]},proxy:!0}])},[e._v(" choose the permissions for the selected role. ")]),t("v-card-text",{staticClass:"grey lighten-4"},[t("v-sheet",{staticClass:"mx-auto",attrs:{"max-width":"500"}},[t("div",[t("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headersPermission,items:e.permission,"sort-by":"calories",search:e.searchPermission,"show-select":""},scopedSlots:e._u([{key:"top",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-text-field",{staticClass:"mx-auto",attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.searchPermission,callback:function(i){e.searchPermission=i},expression:"searchPermission"}})],1)]},proxy:!0}]),model:{value:e.selectedPermission,callback:function(i){e.selectedPermission=i},expression:"selectedPermission"}})],1)])],1)],1)],1)],1)},m=[],h=l(d,c,m,!1,null,null);const b=h.exports;export{b as default};
