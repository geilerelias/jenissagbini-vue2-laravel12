import{n as g}from"./_plugin-vue2_normalizer-p4i_2SC9.js";const d={name:"picture-input",props:{width:{type:[String,Number],default:Number.MAX_SAFE_INTEGER},height:{type:[String,Number],default:Number.MAX_SAFE_INTEGER},margin:{type:[String,Number],default:0},accept:{type:String,default:"image/*"},capture:{type:String,default:null},size:{type:[String,Number],default:Number.MAX_SAFE_INTEGER},name:{type:String,default:null},id:{type:[String,Number],default:null},buttonClass:{type:String,default:"btn btn-primary button"},removeButtonClass:{type:String,default:"btn btn-secondary button secondary"},aspectButtonClass:{type:String,default:"btn btn-secondary button secondary"},prefill:{type:typeof File>"u"||typeof Blob>"u"?[String]:[String,File,Blob],default:""},prefillOptions:{type:Object,default:()=>({})},crop:{type:Boolean,default:!0},radius:{type:[String,Number],default:0},removable:{type:Boolean,default:!1},hideChangeButton:{type:Boolean,default:!1},autoToggleAspectRatio:{type:Boolean,default:!1},toggleAspectRatio:{type:Boolean,default:!1},changeOnClick:{type:Boolean,default:!0},plain:{type:Boolean,default:!1},zIndex:{type:Number,default:1e4},alertOnError:{type:Boolean,default:!0},customStrings:{type:Object,default:()=>({})}},watch:{prefill(){this.prefill?this.preloadImage(this.prefill,this.prefillOptions):this.removeImage()}},data(){return{imageSelected:!1,previewHeight:0,previewWidth:0,draggingOver:!1,canvasWidth:0,canvasHeight:0,strings:{upload:"<p>Your device does not support file uploading.</p>",drag:"Drag an image or <br>click here to select a file",tap:"Tap here to select a photo <br>from your gallery",change:"Change Photo",aspect:"Landscape/Portrait",remove:"Remove Photo",select:"Select a Photo",selected:"<p>Photo successfully selected!</p>",fileSize:"The file size exceeds the limit",fileType:"This file type is not supported."}}},mounted(){if(this.updateStrings(),this.prefill&&this.preloadImage(this.prefill,this.prefillOptions),this.$nextTick(()=>{window.addEventListener("resize",this.onResize),this.onResize()}),this.supportsPreview){this.pixelRatio=Math.round(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI);const t=this.$refs.previewCanvas;t.getContext&&(this.context=t.getContext("2d"),this.context.scale(this.pixelRatio,this.pixelRatio))}this.accept!=="image/*"&&(this.fileTypes=this.accept.split(","),this.fileTypes=this.fileTypes.map(t=>t.trim())),this.canvasWidth=this.width,this.canvasHeight=this.height,this.width!=Number.MAX_SAFE_INTEGER&&this.height!=Number.MAX_SAFE_INTEGER&&(this.previewWidth=this.width,this.previewHeight=this.height),this.$on("error",this.onError)},beforeDestroy(){window.removeEventListener("resize",this.onResize),this.$off("error",this.onError)},methods:{updateStrings(){for(let t in this.customStrings)t in this.strings&&typeof this.customStrings[t]=="string"&&(this.strings[t]=this.customStrings[t])},onClick(){if(!this.imageSelected){this.selectImage();return}this.changeOnClick&&this.selectImage(),this.$emit("click")},onResize(){this.resizeCanvas()&&this.imageObject&&this.drawImage(this.imageObject)},onDragEnter(){this.supportsDragAndDrop&&(this.draggingOver=!0)},onDragLeave(){this.supportsDragAndDrop&&(this.draggingOver=!1)},onFileDrop(t){this.onDragLeave(),this.onFileChange(t)},onFileChange(t,e){let i=t.target.files||t.dataTransfer.files;if(i.length){if(i[0].size<=0||i[0].size>this.size*1024*1024){this.$emit("error",{type:"fileSize",fileSize:i[0].size,fileType:i[0].type,fileName:i[0].name,message:this.strings.fileSize+" ("+this.size+"MB)"});return}if(!(i[0].name===this.fileName&&i[0].size===this.fileSize&&this.fileModified===i[0].lastModified)){if(this.file=i[0],this.fileName=i[0].name,this.fileSize=i[0].size,this.fileModified=i[0].lastModified,this.fileType=i[0].type,this.accept==="image/*"){if(i[0].type.substr(0,6)!=="image/")return}else if(this.fileTypes.indexOf(i[0].type)===-1){this.$emit("error",{type:"fileType",fileSize:i[0].size,fileType:i[0].type,fileName:i[0].name,message:this.strings.fileType});return}this.imageSelected=!0,this.image="",this.supportsPreview?this.loadImage(i[0],e||!1):e?this.$emit("prefill"):this.$emit("change",this.image)}}},onError(t){this.alertOnError&&alert(t.message)},loadImage(t,e){this.getEXIFOrientation(t,i=>{this.setOrientation(i);let s=new FileReader;s.onload=a=>{this.image=a.target.result,e?this.$emit("prefill"):this.$emit("change",this.image),this.imageObject=new Image,this.imageObject.onload=()=>{if(this.autoToggleAspectRatio){let l=this.getOrientation(this.canvasWidth,this.canvasHeight),r=this.getOrientation(this.imageObject.width,this.imageObject.height);l!==r&&this.rotateCanvas()}this.drawImage(this.imageObject)},this.imageObject.src=this.image},s.readAsDataURL(t)})},drawImage(t){this.imageWidth=t.width,this.imageHeight=t.height,this.imageRatio=t.width/t.height;let e=0,i=0,s=this.previewWidth,a=this.previewHeight;const l=this.previewWidth/this.previewHeight;this.crop?this.imageRatio>=l?(s=a*this.imageRatio,e=(this.previewWidth-s)/2):(a=s/this.imageRatio,i=(this.previewHeight-a)/2):this.imageRatio>=l?(a=s/this.imageRatio,i=(this.previewHeight-a)/2):(s=a*this.imageRatio,e=(this.previewWidth-s)/2);const r=this.$refs.previewCanvas;r.style.background="none",r.width=this.previewWidth*this.pixelRatio,r.height=this.previewHeight*this.pixelRatio,this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,r.width,r.height),this.rotate&&typeof this.imageObject.style.imageOrientation>"u"&&(this.context.translate(e*this.pixelRatio,i*this.pixelRatio),this.context.translate(s/2*this.pixelRatio,a/2*this.pixelRatio),this.context.rotate(this.rotate),e=-s/2,i=-a/2),this.context.drawImage(t,e*this.pixelRatio,i*this.pixelRatio,s*this.pixelRatio,a*this.pixelRatio)},selectImage(){this.$refs.fileInput.click()},removeImage(){this.$refs.fileInput.value="",this.$refs.fileInput.type="",this.$refs.fileInput.type="file",this.fileName="",this.fileType="",this.fileSize=0,this.fileModified=0,this.imageSelected=!1,this.image="",this.file=null,this.imageObject=null,this.$refs.previewCanvas.style.backgroundColor="rgba(200,200,200,.25)",this.$refs.previewCanvas.width=this.previewWidth*this.pixelRatio,this.$emit("remove")},rotateImage(){this.rotateCanvas(),this.imageObject&&this.drawImage(this.imageObject);let t=this.getOrientation(this.canvasWidth,this.canvasHeight);this.$emit("aspectratiochange",t)},resizeCanvas(){let t=this.canvasWidth/this.canvasHeight,e=this.$refs.container.clientWidth;return!e||!this.toggleAspectRatio&&e===this.containerWidth?!1:(this.containerWidth=e,this.previewWidth=Math.min(this.containerWidth-this.margin*2,this.canvasWidth),this.previewHeight=this.previewWidth/t,!0)},getOrientation(t,e){let i="square";return t>e?i="landscape":t<e&&(i="portrait"),i},switchCanvasOrientation(){const t=this.canvasWidth,e=this.canvasHeight;this.canvasWidth=e,this.canvasHeight=t},rotateCanvas(){this.switchCanvasOrientation(),this.resizeCanvas()},setOrientation(t){this.rotate=!1,t===8?this.rotate=-Math.PI/2:t===6?this.rotate=Math.PI/2:t===3&&(this.rotate=-Math.PI)},getEXIFOrientation(t,e){var i=new FileReader;i.onload=s=>{var a=new DataView(s.target.result);if(a.getUint16(0,!1)!==65496)return e(-2);for(var l=a.byteLength,r=2;r<l;){var n=a.getUint16(r,!1);if(r+=2,n===65505){if(a.getUint32(r+=2,!1)!==1165519206)return e(-1);var o=a.getUint16(r+=6,!1)===18761;r+=a.getUint32(r+4,o);var p=a.getUint16(r,o);r+=2;for(var h=0;h<p;h++)if(a.getUint16(r+h*12,o)===274)return e(a.getUint16(r+h*12+8,o))}else{if((n&65280)!==65280)break;r+=a.getUint16(r,!1)}}return e(-1)},i.readAsArrayBuffer(t.slice(0,65536))},preloadImage(t,e){let i=window.File;try{new i([],"")}catch{i=class extends Blob{constructor(r,n,o={}){super(r,o),this.lastModifiedDate=new Date,this.lastModified=+this.lastModifiedDate,this.name=n}}}if(e=Object.assign({},e),typeof t=="object"){this.imageSelected=!0,this.image="",this.supportsPreview?this.loadImage(t,!0):this.$emit("prefill");return}t.indexOf("data:")===-1&&(t.indexOf("?")!==-1?t+="&_="+new Date().getTime():t+="?_="+new Date().getTime());let s=new Headers;s.append("Accept","image/*"),fetch(t,{method:"GET",mode:"cors",headers:s}).then(a=>a.blob()).then(a=>{let l={target:{files:[]}};const r=e.fileName||t.split("/").slice(-1)[0];let n=e.mediaType||"image/"+(e.fileType||r.split("?")[0].split(".").slice(-1)[0].split("?")[0]);n=n.replace("jpg","jpeg"),n=n.replace("image/svg","image/svg+xml"),n==="image/svg"&&(n="image/svg+xml"),l.target.files[0]=new i([a],r,{type:n}),this.onFileChange(l,!0)}).catch(a=>{this.$emit("error",{type:"failedPrefill",message:"Failed loading prefill image: "+a})})}},computed:{supportsUpload(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;const t=document.createElement("input");return t.type="file",!t.disabled},supportsPreview(){return window.FileReader&&!!window.CanvasRenderingContext2D},supportsDragAndDrop(){const t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&!("ontouchstart"in window||navigator.msMaxTouchPoints)},computedClasses(){const t={};return t["dragging-over"]=this.draggingOver,t},fontSize(){return Math.min(.04*this.previewWidth,21)+"px"}}};var u=function(){var e=this,i=e._self._c;return i("div",{ref:"container",staticClass:"picture-input",attrs:{id:"picture-input"}},[e.supportsUpload?e.supportsPreview?i("div",[i("div",{staticClass:"preview-container",style:{maxWidth:e.previewWidth+"px",height:e.previewHeight+"px",borderRadius:e.radius+"%"}},[i("canvas",{ref:"previewCanvas",staticClass:"picture-preview",class:e.computedClasses,style:{height:e.previewHeight+"px",zIndex:e.zIndex+1},attrs:{tabindex:"0"},on:{drag:function(s){s.stopPropagation(),s.preventDefault()},dragover:function(s){s.stopPropagation(),s.preventDefault()},dragstart:function(s){s.stopPropagation(),s.preventDefault()},dragend:function(s){s.stopPropagation(),s.preventDefault()},dragenter:function(s){return s.stopPropagation(),s.preventDefault(),e.onDragEnter.apply(null,arguments)},dragleave:function(s){return s.stopPropagation(),s.preventDefault(),e.onDragLeave.apply(null,arguments)},drop:function(s){return s.stopPropagation(),s.preventDefault(),e.onFileDrop.apply(null,arguments)},click:function(s){return s.preventDefault(),e.onClick.apply(null,arguments)},keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.onClick.apply(null,arguments)}}}),!e.imageSelected&&!e.plain?i("div",{staticClass:"picture-inner",style:{top:-e.previewHeight+"px",marginBottom:-e.previewHeight+"px",fontSize:e.fontSize,borderRadius:e.radius+"%",zIndex:e.zIndex+2}},[e.supportsDragAndDrop?i("span",{staticClass:"picture-inner-text",domProps:{innerHTML:e._s(e.strings.drag)}}):i("span",{staticClass:"picture-inner-text",domProps:{innerHTML:e._s(e.strings.tap)}})]):e._e()]),e.imageSelected&&!e.hideChangeButton?i("button",{class:e.buttonClass,attrs:{type:"button"},on:{click:function(s){return s.preventDefault(),e.selectImage.apply(null,arguments)}}},[e._v(e._s(e.strings.change))]):e._e(),e.imageSelected&&e.removable?i("button",{class:e.removeButtonClass,attrs:{type:"button"},on:{click:function(s){return s.preventDefault(),e.removeImage.apply(null,arguments)}}},[e._v(e._s(e.strings.remove))]):e._e(),e.imageSelected&&e.toggleAspectRatio&&e.width!==e.height?i("button",{class:e.aspectButtonClass,attrs:{type:"button"},on:{click:function(s){return s.preventDefault(),e.rotateImage.apply(null,arguments)}}},[e._v(e._s(e.strings.aspect))]):e._e()]):i("div",[e.imageSelected?i("div",[i("div",{domProps:{innerHTML:e._s(e.strings.selected)}}),e.hideChangeButton?e._e():i("button",{class:e.buttonClass,attrs:{type:"button"},on:{click:function(s){return s.preventDefault(),e.selectImage.apply(null,arguments)}}},[e._v(e._s(e.strings.change))]),e.removable?i("button",{class:e.removeButtonClass,attrs:{type:"button"},on:{click:function(s){return s.preventDefault(),e.removeImage.apply(null,arguments)}}},[e._v(e._s(e.strings.remove))]):e._e()]):i("button",{class:e.buttonClass,attrs:{type:"button"},on:{click:function(s){return s.preventDefault(),e.selectImage.apply(null,arguments)}}},[e._v(e._s(e.strings.select))])]):i("div",{domProps:{innerHTML:e._s(e.strings.upload)}}),i("input",{ref:"fileInput",attrs:{type:"file",name:e.name,id:e.id,accept:e.accept,capture:e.capture},on:{change:e.onFileChange}})])},f=[],c=g(d,u,f,!1,null,"3abfe489");const y=c.exports;export{y as P};
